<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EditSingle.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">calendar</a> &gt; <a href="index.source.html" class="el_package">calendar.strategy</a> &gt; <span class="el_source">EditSingle.java</span></div><h1>EditSingle.java</h1><pre class="source lang-java linenums">package calendar.strategy;

import static calendar.util.EditEvent.createModifiedEvent;
import static calendar.util.EditEvent.createModifiedEventMulti;
import static calendar.util.EditEvent.findEventBySubjectStartEnd;
import static calendar.util.EditEvent.validateNoDuplicate;

import calendar.dto.EditEventDto;
import calendar.interfacetypes.Iedit;
import calendar.model.Event;
import java.time.ZoneId;
import java.util.HashSet;
import java.util.Set;
import java.util.UUID;

/**
 * Implements the &quot;edit event&quot; (single) logic.
 * Modifies only ONE specific event identified by subject, start, and end time.
 * Breaks from series by assigning a new UUID if editing start time.
 */
<span class="fc" id="L21">public class EditSingle implements Iedit {</span>

  @Override
  public void edit(EditEventDto dto, Set&lt;Event&gt; events, ZoneId timezone) throws Exception {
<span class="fc" id="L25">    Event targetEvent = findEventBySubjectStartEnd(dto, events, timezone);</span>
<span class="fc" id="L26">    Set&lt;Event&gt; eventsToRemove = new HashSet&lt;&gt;();</span>
<span class="fc" id="L27">    eventsToRemove.add(targetEvent);</span>
<span class="fc" id="L28">    Set&lt;Event&gt; eventsToCommit = new HashSet&lt;&gt;();</span>
<span class="fc" id="L29">    String newSeriesId = determineNewSeriesId(targetEvent, dto);</span>
    Event newEvent;
<span class="fc bfc" id="L31" title="All 2 branches covered.">    if (dto.hasMultipleProperties()) {</span>
<span class="fc" id="L32">      newEvent = createModifiedEventMulti(</span>
          targetEvent,
<span class="fc" id="L34">          dto.getPropertyChanges(),</span>
          newSeriesId,
          timezone,
          events,
          eventsToRemove,
          eventsToCommit
      );
    } else {
<span class="fc" id="L42">      newEvent = createModifiedEvent(targetEvent, dto, newSeriesId, timezone);</span>
<span class="fc" id="L43">      validateNoDuplicate(newEvent, events, eventsToCommit, eventsToRemove);</span>
    }
<span class="fc" id="L45">    eventsToCommit.add(newEvent);</span>
<span class="fc" id="L46">    events.removeAll(eventsToRemove);</span>
<span class="fc" id="L47">    events.addAll(eventsToCommit);</span>
<span class="fc" id="L48">  }</span>

  /**
   * Determines the new series ID based on whether start time is being modified.
   * If start time is modified, breaks from series with new UUID.
   * Otherwise, maintains existing series ID.
   */
  private String determineNewSeriesId(Event targetEvent, EditEventDto dto) {
<span class="fc" id="L56">    String newSeriesId = &quot;&quot;;</span>

<span class="pc bpc" id="L58" title="1 of 4 branches missed.">    if (targetEvent.getSeriesId() != null &amp;&amp; !targetEvent.getSeriesId().isEmpty()) {</span>
<span class="fc" id="L59">      boolean isStartBeingModified = false;</span>
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">      if (dto.hasMultipleProperties()) {</span>
<span class="nc" id="L61">        isStartBeingModified = dto.getPropertyChanges().containsKey(&quot;start&quot;);</span>
      } else {
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">        isStartBeingModified = dto.getProperty() != null</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">            &amp;&amp; dto.getProperty().equalsIgnoreCase(&quot;start&quot;);</span>
      }
<span class="fc bfc" id="L66" title="All 2 branches covered.">      if (isStartBeingModified) {</span>
<span class="fc" id="L67">        newSeriesId = UUID.randomUUID().toString();</span>
      } else {
<span class="fc" id="L69">        newSeriesId = targetEvent.getSeriesId();</span>
      }
    }
<span class="fc" id="L72">    return newSeriesId;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>